version: '3.8'

services:
  minestudio:
    build:
      context: .
      dockerfile: Dockerfile.cpu
      platform: linux/amd64
    image: mcu-benchmark-cpu
    container_name: minestudio-agent
    platform: linux/amd64
    volumes:
      - .:/workspace
      - minestudio_cache:/opt/minestudio
    environment:
      - DISPLAY=:99
      - JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
      - MINESTUDIO_DIR=/opt/minestudio
      - AUTO_DOWNLOAD_ENGINE=1
      - MINECRAFT_MAX_MEM=2G
    working_dir: /workspace
    stdin_open: true
    tty: true
    mem_limit: 20g
    memswap_limit: 20g
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
      nproc:
        soft: 4096
        hard: 4096
    command: /bin/bash

volumes:
  minestudio_cache:
    driver: local

